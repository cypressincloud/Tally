# Tally (纯本地自动记账助手)

> **招财进宝，财源广进**

Tally 是一款基于 Android 原生开发的**纯本地**个人财务管理应用。它拒绝云端同步，专注于数据隐私安全，利用 Android 无障碍服务（Accessibility Service）实现自动化的记账体验，同时提供强大的资产管理、加班统计和数据分析功能。

## 🌟 核心亮点

* **纯本地化**：所有数据存储在本地 SQLite 数据库，无网络请求，无隐私泄露风险。
* **智能自动化**：基于无障碍服务的屏幕内容分析，自动识别支付场景并弹窗记账。
* **功能全面**：涵盖收支记录、资产管理、负债/借出管理、加班工资计算及多维度报表。

---

## 🚀 详细功能列表

### 1. ⚡ 智能自动记账 (核心功能)
* **屏幕内容捕获**：通过无障碍服务实时监听屏幕内容，智能识别主流应用（微信、支付宝、淘宝、京东、拼多多、抖音、美团等）的支付界面。
* **自动金额提取**：自动正则匹配屏幕上的金额数字，过滤无关干扰项。
* **智能悬浮窗**：识别到交易后，自动弹出悬浮确认窗，包含金额、分类（支持自动归类）、备注和关联资产，点击“保存”即可完成记账。
* **自动资产关联**：支持自定义规则（关键字+应用包名），例如识别到“招商银行”关键字时，自动将该笔交易关联到“招商银行卡”资产账户。

### 2. 📝 便捷手动记账
* **快速记账磁贴**：下拉通知栏点击“记一笔”磁贴，无需打开 App 即可通过悬浮窗快速记账。
* **多维度记录**：支持记录金额、收支类型、分类、备注、关联资产账户。
* **加班记录模式**：
    * 专门的加班记录入口。
    * 支持设置平时/节假日时薪。
    * 输入时长自动计算加班费，并计入收入统计。

### 3. 💰 资产全景管理
* **三大资产类型**：
    * **我的资产**：现金、银行卡、储蓄等。
    * **我的负债**：信用卡、花呗、借款等。
    * **我的借出**：借给他人的款项管理。
* **默认资产设置**：可设置默认扣款账户（如默认使用微信零钱），提高记账效率。
* **资产变动联动**：记账时选择资产，资产余额会自动更新；删除或撤销交易，资产余额自动回滚。

### 4. 📊 数据统计与分析
* **多视图报表**：支持按 **周 / 月 / 年** 维度查看收支情况。
* **图表可视化**：
    * **折线图**：直观展示收入、支出及净资产的趋势变化。
    * **饼状图**：
        * 支出饼图：分析消费构成（如餐饮、购物占比）。
        * 收入饼图：分析收入来源。
    * 支持点击图表查看具体分类的详细账单列表。
* **加班统计**：独立统计工作日与节假日的加班时长及加班总收入，甚至估算月薪（底薪+加班费）。
* **年度账单（热力图）**：通过类似 GitHub 的贡献度热力图，直观展示全年的记账频率和金额分布。

### 5. ⚙️ 个性化与设置
* **分类管理**：完全自定义支出和收入的分类标签。
* **夜间模式**：支持手动切换深色/浅色主题，保护视力。
* **极简模式**：开启后隐藏非必要设置入口，界面更清爽（极简模式下通过长按“统计”Tab 进入设置）。
* **关键字设置**：自定义触发自动记账的关键字（如“支付成功”、“收款”）。
* **薪资设置**：配置月底薪及加班时薪标准，辅助统计计算。

### 6. 💾 数据安全与备份
* **ZIP 备份/恢复**：支持将所有账单和资产数据打包导出为 ZIP 文件，或从 ZIP 恢复。
* **JSON 导入**：支持导入外部标准格式的 JSON 账单数据。
* **撤销功能**：记账错误可快速撤销，并自动回滚关联的资产金额。

---

## 🛡️ 权限说明与保活指南 (重要)

为了实现自动记账和后台稳定运行，Tally 需要以下敏感权限。请务必在系统设置中授予，否则核心功能将无法使用。

### 1. 自启动权限
* **用途**：允许应用在手机开机或后台被杀后自动重启服务。
* **设置**：在系统设置 -> 应用管理 -> Tally -> 权限/电池管理中，开启“允许自启动”。

### 2. 无障碍权限 (Accessibility Service)
* **用途**：
    * **核心**：用于读取屏幕上的支付金额和商家名称，实现自动记账。
    * **保活**：配合“无障碍管理器”等工具，无障碍服务本身具有较高的系统优先级，能防止应用被系统轻易查杀。
* **设置**：在系统设置 -> 辅助功能/无障碍 -> 已下载的服务 -> 开启“记账屏幕同步助手”。

### 3. 悬浮窗权限 (System Alert Window)
* **用途**：
    * **自动记账弹窗**：当监测到账单时，在屏幕顶层弹出确认窗口。
    * **快捷记账**：点击通知栏磁贴时弹出记账窗口。
    * **1像素保活**：应用会在屏幕边缘生成一个肉眼不可见的 1 像素悬浮窗，用于欺骗系统判定应用为“前台运行”，从而极大降低被系统杀后台的概率。
* **设置**：在系统设置 -> 应用管理 -> Tally -> 权限 -> 开启“显示在其他应用上层”。

### 4. 通知权限 (Notification)
* **用途**：
    * **前台服务标识**：显示一个常驻通知（"Tally正在运行"），告知系统该应用正在前台服务中，防止进程被冻结。
    * **测试运行状态**：您可以通过是否存在通知栏图标来判断自动记账服务是否存活。
* **说明**：如果您确认服务运行稳定，可以在系统设置中关闭通知显示，这不会影响功能的正常使用。

### 5. 绑定快捷设置磁贴 (Quick Settings Tile)
* **用途**：允许将“记一笔”添加到下拉状态栏的快捷开关中，方便随时调用。

---

## 🛠️ 技术栈

* **语言**: Java
* **架构**: MVVM (ViewModel + LiveData)
* **数据库**: Room (SQLite)
* **图表库**: MPAndroidChart
* **UI**: Material Design Components, ViewBinding
* **构建**: Gradle

---

## ⚠️ 免责声明

本应用利用 Android 无障碍服务读取屏幕内容，仅用于提取金额和商户信息以辅助记账。所有数据均存储于用户手机本地数据库中，不会上传至任何服务器。请用户放心使用。
